# 🎉 v1.0.4 重大更新说明

## ✨ 新增功能

### 1. 插件开关功能 🔘
- **默认关闭状态**：安装后插件不会自动运行，需要手动开启
- **一键切换**：在 popup 面板顶部添加了开关按钮
- **状态显示**：清晰显示"已启用"或"已关闭"状态
- **智能提示**：切换状态时会有 Toast 提示

**使用方法：**
1. 点击浏览器工具栏的插件图标
2. 点击开关按钮启用插件
3. 刷新要使用的网页
4. 开始划词收集！

---

## 🐛 重要修复

### 2. 修复清空后数据重现的问题 ✅
**问题描述：** 之前清空后再划词，旧数据会重新出现

**原因分析：**
- 清空时只清除了 storage，但内存中的 `collectedPhrases` 数组没有正确清空
- 下次划词时，数据会重新从 storage 加载

**修复方案：**
```javascript
// 清空时同时清除内存和存储
collectedPhrases = [];
chrome.storage.local.set({ phrases: [] });
```

现在清空后：
- ✅ 内存数据立即清空
- ✅ 存储数据同步清空
- ✅ 页面高亮全部移除
- ✅ 浮窗立即更新显示

---

## 📋 完整功能列表

### 开关控制
- ✅ 默认关闭，需手动启用
- ✅ 状态持久化保存
- ✅ 切换时有提示反馈
- ✅ 关闭时自动隐藏浮窗

### 数据管理
- ✅ 清空功能彻底清除数据
- ✅ 不会重新加载旧数据
- ✅ 实时同步存储状态

### 用户体验
- ✅ 开关状态可视化
- ✅ Toast 提示反馈
- ✅ 更清晰的使用指引

---

## 🚀 使用流程

### 第一次使用

1. **安装插件**
   ```
   chrome://extensions/ → 加载已解压的扩展程序
   ```

2. **启用插件**
   ```
   点击插件图标 → 打开开关 → 显示"已启用"
   ```

3. **刷新页面**
   ```
   在要使用的网页按 F5 刷新
   ```

4. **开始使用**
   ```
   划选文本 → 自动高亮和收集
   ```

### 日常使用

- **临时关闭**：点击插件图标 → 关闭开关
- **重新启用**：点击插件图标 → 打开开关
- **查看收集**：点击"显示浮窗"按钮
- **导出数据**：点击"复制全部到剪贴板"
- **清空数据**：点击"清空所有词句"

---

## ⚙️ 技术改进

### 状态管理优化
```javascript
// 新增开关状态管理
let isEnabled = false;

// 持久化存储
chrome.storage.local.set({ isEnabled: true });

// 实时同步
chrome.runtime.onMessage.addListener(...)
```

### 数据清空优化
```javascript
// 确保彻底清空
function clearAllPhrases() {
  collectedPhrases = [];  // 清空内存
  chrome.storage.local.set({ phrases: [] });  // 清空存储
  // 清除DOM高亮
  // 更新UI显示
}
```

---

## 🎨 UI 改进

### Popup 面板

**新增开关区域：**
```
┌─────────────────────────────┐
│ 📝 英文划词收集器            │
│                             │
│ ┌───────────────────────┐   │
│ │ 插件状态  🔘  已启用   │   │
│ └───────────────────────┘   │
│                             │
│ 已收集词句: 5               │
│ 当前页面: example.com       │
│                             │
│ [👁️ 显示浮窗]              │
│ [📋 复制全部到剪贴板]       │
│ [🗑️ 清空所有词句]          │
└─────────────────────────────┘
```

**样式特点：**
- 优雅的切换开关动画
- 清晰的状态文字显示
- 启用时绿色高亮

---

## 🔍 问题排查

### 如果开关无法切换

1. **刷新页面**
   - 切换开关后需要刷新页面
   - 按 F5 或 Cmd+R

2. **检查控制台**
   - 按 F12 查看是否有错误
   - 查看 Extension enabled: true/false

3. **重新加载插件**
   - chrome://extensions/
   - 点击刷新图标 🔄

### 如果清空后数据又出现

1. **确认使用最新版本**
   - 版本号应为 v1.0.4
   - 在 manifest.json 中查看

2. **完全重新安装**
   - 卸载旧版本
   - 清除浏览器缓存
   - 安装 v1.0.4

3. **手动清除存储**
   ```javascript
   // 在控制台执行
   chrome.storage.local.clear();
   ```

---

## 📝 升级指南

### 从 v1.0.3 升级到 v1.0.4

1. **卸载旧版本**
   ```
   chrome://extensions/ → 找到插件 → 移除
   ```

2. **安装新版本**
   ```
   加载已解压的扩展程序 → 选择 v1.0.4 文件夹
   ```

3. **刷新所有页面**
   ```
   在所有要使用的网页按 F5
   ```

4. **首次启用**
   ```
   点击插件图标 → 打开开关
   ```

**注意：** 升级不会丢失已收集的数据！

---

## 🎯 下一步计划

考虑中的功能（欢迎反馈）：

- [ ] 支持自定义高亮颜色
- [ ] 添加分类标签功能
- [ ] 支持导出为 Markdown 格式
- [ ] 添加快捷键支持
- [ ] 支持同步到云端
- [ ] 添加笔记功能

有建议？欢迎在 GitHub Issues 提出！

---

## ✅ 测试清单

安装 v1.0.4 后请测试：

- [ ] 插件默认是关闭状态
- [ ] 开关可以正常切换
- [ ] 切换时有 Toast 提示
- [ ] 启用后可以划词收集
- [ ] 关闭后无法划词
- [ ] 清空后数据彻底清除
- [ ] 清空后再划词不会出现旧数据
- [ ] 刷新页面后开关状态保持

---

最后更新：2025-11-15
版本：v1.0.4
